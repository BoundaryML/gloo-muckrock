# This file is generated by the BAML compiler.
# Do not edit this file directly.
# Instead, edit the BAML files and recompile.

# ruff: noqa: E501,F401
# flake8: noqa: E501,F401
# pylint: disable=unused-import,line-too-long
# fmt: off

from ..__do_not_import.generated_baml_client import baml
from ..baml_types import FOIARequestData, IExtractRequestData, IExtractRequestDataStream, RecordsStatus, RequestStatus
from baml_lib._impl.deserializer import Deserializer
from json import dumps
from pytest_baml.ipc_channel import BaseIPCChannel
from typing import Any


@baml.ExtractRequestData.test(stream=True)
async def test_adjacent_apricot(ExtractRequestDataImpl: IExtractRequestDataStream, baml_ipc_channel: BaseIPCChannel):
    def to_str(item: Any) -> str:
        if isinstance(item, str):
            return item
        return dumps(item)

    content = to_str("This morning DTI provided the quote for the email search. Please see below.\n\n\n\n\n\nSent or received:   01/01/2021 thru 02/21/2024*\n\n*Note that typical email retention is only 12 months, but some employees retain older emails in their mailbox\n\n\n\nMailboxes:  All current DOE employees\n\n\n\nKeyword Search: “All emails to/from any @doe.k12.de.us address and any address ending in @discoveryed.com; All emails to/from any @doe.k12.de.us address and any address ending in @dupont.com”\n\n\n\nThe DTI Engineering Team’s labor rate is $38.00/hr.  The DTI estimate for this request is $38.00.  The total estimated time is 2 hours, and billable time is 1 hour, which covers the staff time to extract data that meets your criteria from our email archives.  This is only an estimate.  The actual cost may differ from the estimated cost. I will notify you if there is any change in cost.  The tasks that are involved with compiling this e-records request include:\n\n\n\n\n\n·            Configure search strings\n\n\n\n·            Conduct search\n\n\n\n·            Scrub results to ensure no unintended content is included\n\n\n\n·            Compile results\n\n·            Commit results to media\n\n\n\n\n\nThe Delaware Department of Education is responsible for redacting any emails deemed to be non-public, as defined by  the FOIA Chapter of the Delaware Code at 29 Del. C. sec. 100<http://delcode.delaware.gov/title29/c100/index.shtml>, including emails to/from the Controller General's Staff, General Assembly and staff (29 Del. C. sec. 10002(l)(16)). The cost for this work is $38.77 per hour. A time/cost estimate will be provided once we know how many emails are returned by the search. Payment to DOE will be required before this work begins.\n\n\n\nTo proceed with the search, please pay DTI directly using one of the following methods (please note your case number when making payment as DOE FOIA EREC0002597):\n\n\n\nCheck payable to “DTI” and send to:\n\n\n\nDTI FOIA Coordinator\n\nWilliam Penn Building\n\n801 Silver Lake Blvd\n\nDover, DE  19904\n\n\n\nCredit Card payments can be taken by contacting Kristen Shultz at 302-739-9577.\n\n\n\n\n\nPlease note that the records will be returned as Outlook data files. Any computer running Outlook should be able to open the files.\n\n\n\n\n\n\n\n\n\n\n\nDTI has this request in the queue but will not start work until the agency receives payment.  If payment is not received in 30 days, DTI will close the request.")
    deserializer = Deserializer[str](str) # type: ignore
    param = deserializer.from_string(content)
    async with ExtractRequestDataImpl(param) as stream:
        async for response in stream.parsed_stream:
            baml_ipc_channel.send("partial_response", response.json())

        await stream.get_final_response()

